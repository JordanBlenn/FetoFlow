<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>geometry_utils &#8212; FetoFlow 2025 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=cb975c41"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="helper_functions" href="helper_functions.html" />
    <link rel="prev" title="file_parsing_utils" href="file_parsing_utils.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="geometry-utils">
<h1>geometry_utils<a class="headerlink" href="#geometry-utils" title="Link to this heading">¶</a></h1>
<p>Graph-based geometry helpers. The package uses <code class="xref py py-mod docutils literal notranslate"><span class="pre">networkx</span></code> directed
graphs to represent the vascular tree. Each edge stores attributes such as
<code class="docutils literal notranslate"><span class="pre">length</span></code>, <code class="docutils literal notranslate"><span class="pre">radius</span></code>, <code class="docutils literal notranslate"><span class="pre">resistance</span></code>, <code class="docutils literal notranslate"><span class="pre">edge_id</span></code> and <code class="docutils literal notranslate"><span class="pre">strahler</span></code>.</p>
<section id="main-responsibilities">
<h2>Main responsibilities<a class="headerlink" href="#main-responsibilities" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><dl class="simple">
<dt>Building the initial directed graph from node and element lists</dt><dd><p>(<code class="xref py py-func docutils literal notranslate"><span class="pre">create_geometry()</span></code>).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Adding a venous mesh based on arterial topology</dt><dd><p>(<code class="xref py py-func docutils literal notranslate"><span class="pre">create_venous_mesh()</span></code>).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Computing Strahler ordering for radii assignment</dt><dd><p>(<code class="xref py py-func docutils literal notranslate"><span class="pre">update_strahlers()</span></code>).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Utility helpers to compute lengths, branching angles and to add</dt><dd><p>anastomoses (<code class="xref py py-func docutils literal notranslate"><span class="pre">calcLength()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">calculate_branching_angles()</span></code>,
<code class="xref py py-func docutils literal notranslate"><span class="pre">create_anastomosis()</span></code>).</p>
</dd>
</dl>
</li>
</ul>
<dl>
<dt>create_geometry(nodes, elements, inlet_radius, strahler_ratio_arteries, …)</dt><dd><p>Construct a <code class="xref py py-class docutils literal notranslate"><span class="pre">networkx.DiGraph</span></code> from raw node and element data,
set per-edge defaults, compute Strahler ordering and assign radii.</p>
<dl class="simple">
<dt>nodes<span class="classifier">dict</span></dt><dd><p>Mapping <code class="docutils literal notranslate"><span class="pre">node_id</span> <span class="pre">-&gt;</span> <span class="pre">[x,</span> <span class="pre">y,</span> <span class="pre">z]</span></code> (0-based indices). Produced by
<code class="xref py py-func docutils literal notranslate"><span class="pre">file_parsing_utils.read_nodes()</span></code>.</p>
</dd>
<dt>elements<span class="classifier">list of tuple</span></dt><dd><p>Connectivity list <code class="docutils literal notranslate"><span class="pre">[(node_from,</span> <span class="pre">node_to),</span> <span class="pre">...]</span></code> (0-based indices).</p>
</dd>
<dt>inlet_radius<span class="classifier">float</span></dt><dd><p>Radius (m) used for the root/inlet arterial vessels.</p>
</dd>
<dt>strahler_ratio_arteries<span class="classifier">float</span></dt><dd><p>Scaling factor between Strahler orders used to set vessel radii.</p>
</dd>
<dt>arteries_only<span class="classifier">bool, optional</span></dt><dd><p>When True do not create a venous mesh; only arterial graph is
returned. Default is False.</p>
</dd>
<dt>outlet_vein_radius<span class="classifier">float, optional</span></dt><dd><p>Outlet vein radius (m) used when building the venous mesh. Required
if <code class="docutils literal notranslate"><span class="pre">arteries_only</span></code> is False.</p>
</dd>
<dt>strahler_ratio_veins<span class="classifier">float, optional</span></dt><dd><p>Strahler scaling factor used for veins. Required when building
venous mesh.</p>
</dd>
<dt>fields<span class="classifier">dict, optional</span></dt><dd><p>Optional per-edge fields (for example radius or resistance) as
produced by <code class="xref py py-func docutils literal notranslate"><span class="pre">file_parsing_utils.define_fields_from_files()</span></code>.</p>
</dd>
<dt>default_mu<span class="classifier">float, optional</span></dt><dd><p>Default dynamic viscosity (Pa.s) assigned to edges.</p>
</dd>
<dt>default_hematocrit<span class="classifier">float, optional</span></dt><dd><p>Default hematocrit value assigned to edges.</p>
</dd>
</dl>
<dl class="simple">
<dt>networkx.DiGraph</dt><dd><p>Directed graph with nodes and edges annotated with attributes
such as <code class="docutils literal notranslate"><span class="pre">length</span></code>, <code class="docutils literal notranslate"><span class="pre">radius</span></code>, <code class="docutils literal notranslate"><span class="pre">edge_id</span></code>, <code class="docutils literal notranslate"><span class="pre">strahler</span></code> and
<code class="docutils literal notranslate"><span class="pre">vessel_type</span></code>.</p>
</dd>
</dl>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">create_venous_mesh()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">update_strahlers()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">create_anastomosis()</span></code></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">FetoFlow.file_parsing_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">read_nodes</span><span class="p">,</span> <span class="n">read_elements</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nodes</span> <span class="o">=</span> <span class="n">read_nodes</span><span class="p">(</span><span class="s1">&#39;placenta.ipnode&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">elements</span> <span class="o">=</span> <span class="n">read_elements</span><span class="p">(</span><span class="s1">&#39;placenta.ipelem&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">G</span> <span class="o">=</span> <span class="n">create_geometry</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">inlet_radius</span><span class="o">=</span><span class="mf">0.002</span><span class="p">,</span> <span class="n">strahler_ratio_arteries</span><span class="o">=</span><span class="mf">0.79</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>create_venous_mesh(…)</dt><dd><p>Build a venous graph by copying and relabelling the arterial graph,
applying vein radii and reversing edge directions.</p>
</dd>
<dt>update_strahlers(G, node_in, node_out)</dt><dd><p>Recursive Strahler calculation used during geometry construction.</p>
</dd>
<dt>create_anastomosis(G, node_from, node_to, radius=None, mu=…)</dt><dd><p>Add a connecting edge (anastomosis) between two nodes and compute an
approximate resistance for it. Input indices are in the external
(1-based) IPNODE indexing and converted to internal 0-based indices.</p>
</dd>
</dl>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Link to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">create_geometry</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">inlet_radius</span><span class="o">=</span><span class="mf">0.002</span><span class="p">,</span> <span class="n">strahler_ratio_arteries</span><span class="o">=</span><span class="mf">0.79</span><span class="p">)</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">create_anastomosis</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">node_from</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">node_to</span><span class="o">=</span><span class="mi">34</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="api-reference">
<h2>API reference<a class="headerlink" href="#api-reference" title="Link to this heading">¶</a></h2>
</section>
<section id="function-arguments">
<h2>Function arguments<a class="headerlink" href="#function-arguments" title="Link to this heading">¶</a></h2>
<dl>
<dt>create_geometry</dt><dd><dl class="simple">
<dt>nodes<span class="classifier">dict</span></dt><dd><p>Mapping <code class="docutils literal notranslate"><span class="pre">node_id</span> <span class="pre">-&gt;</span> <span class="pre">[x,</span> <span class="pre">y,</span> <span class="pre">z]</span></code> (0-based indices). Produced by
<code class="xref py py-func docutils literal notranslate"><span class="pre">file_parsing_utils.read_nodes()</span></code>.</p>
</dd>
<dt>elements<span class="classifier">list of tuple</span></dt><dd><p>Connectivity list <code class="docutils literal notranslate"><span class="pre">[(node_from,</span> <span class="pre">node_to),</span> <span class="pre">...]</span></code> (0-based indices).</p>
</dd>
<dt>inlet_radius<span class="classifier">float</span></dt><dd><p>Radius (m) used for the root/inlet arterial vessels.</p>
</dd>
<dt>strahler_ratio_arteries<span class="classifier">float</span></dt><dd><p>Scaling factor between Strahler orders used to set vessel radii.</p>
</dd>
<dt>arteries_only<span class="classifier">bool, optional</span></dt><dd><p>When True do not create a venous mesh; only arterial graph is
returned. Default is False.</p>
</dd>
<dt>outlet_vein_radius<span class="classifier">float, optional</span></dt><dd><p>Outlet vein radius (m) used when building the venous mesh. Required
if <code class="docutils literal notranslate"><span class="pre">arteries_only</span></code> is False.</p>
</dd>
<dt>strahler_ratio_veins<span class="classifier">float, optional</span></dt><dd><p>Strahler scaling factor used for veins. Required when building
venous mesh.</p>
</dd>
<dt>fields<span class="classifier">dict, optional</span></dt><dd><p>Optional per-edge fields (for example radius or resistance) as
produced by <code class="xref py py-func docutils literal notranslate"><span class="pre">file_parsing_utils.define_fields_from_files()</span></code>.</p>
</dd>
<dt>default_mu<span class="classifier">float, optional</span></dt><dd><p>Default dynamic viscosity (Pa.s) assigned to edges.</p>
</dd>
<dt>default_hematocrit<span class="classifier">float, optional</span></dt><dd><p>Default hematocrit value assigned to edges.</p>
</dd>
</dl>
<dl>
<dt>networkx.DiGraph</dt><dd><p>Directed graph with nodes and edges annotated with attributes
such as <code class="docutils literal notranslate"><span class="pre">length</span></code>, <code class="docutils literal notranslate"><span class="pre">radius</span></code>, <code class="docutils literal notranslate"><span class="pre">edge_id</span></code>, <code class="docutils literal notranslate"><span class="pre">strahler</span></code> and
<code class="docutils literal notranslate"><span class="pre">vessel_type</span></code>.</p>
<p>The function will compute Strahler numbers for each edge and assign
radii by scaling from the inlet radius. If a <code class="docutils literal notranslate"><span class="pre">fields</span></code> dict is
provided and contains a <code class="docutils literal notranslate"><span class="pre">radius</span></code> field that value is used where
specified and Strahler scaling applied elsewhere.</p>
<ul class="simple">
<li><p>Use <code class="xref py py-func docutils literal notranslate"><span class="pre">FetoFlow.file_parsing_utils.read_nodes()</span></code> and
<code class="xref py py-func docutils literal notranslate"><span class="pre">FetoFlow.file_parsing_utils.read_elements()</span></code> to produce the
<code class="docutils literal notranslate"><span class="pre">nodes</span></code> and <code class="docutils literal notranslate"><span class="pre">elements</span></code> inputs to this function.</p></li>
</ul>
</dd>
<dt>create_venous_mesh</dt><dd><dl class="simple">
<dt>G<span class="classifier">networkx.DiGraph</span></dt><dd><p>The arterial graph to copy and relabel into a venous mesh.</p>
</dd>
</dl>
<dl class="simple">
<dt>networkx.DiGraph</dt><dd><p>Venous mesh graph with relabelled nodes and vein attributes.</p>
</dd>
</dl>
<p>The venous mesh is generated by copying the arterial topology,
relabelling node ids (offset by <code class="docutils literal notranslate"><span class="pre">num_artery_nodes</span></code>) and reversing
edges. The function is usually called internally by
<code class="xref py py-func docutils literal notranslate"><span class="pre">create_geometry()</span></code> when <code class="docutils literal notranslate"><span class="pre">arteries_only=False</span></code>.</p>
</dd>
<dt>update_strahlers</dt><dd><dl class="simple">
<dt>G<span class="classifier">networkx.DiGraph</span></dt><dd><p>Graph to update in-place.</p>
</dd>
<dt>node_in, node_out<span class="classifier">int</span></dt><dd><p>Edge endpoints describing the arc for which Strahler ordering
should be computed. This function is recursive and intended to
be used during geometry building.</p>
</dd>
</dl>
<dl class="simple">
<dt>networkx.DiGraph</dt><dd><p>The graph with updated <code class="docutils literal notranslate"><span class="pre">strahler</span></code> attributes.</p>
</dd>
</dl>
</dd>
<dt>create_anastomosis</dt><dd><dl class="simple">
<dt>G<span class="classifier">networkx.DiGraph</span></dt><dd><p>Graph to modify.</p>
</dd>
<dt>node_from<span class="classifier">int</span></dt><dd><p>1-based ipnode index identifying the anastomosis start node.</p>
</dd>
<dt>node_to<span class="classifier">int</span></dt><dd><p>1-based ipnode index identifying the anastomosis end node.</p>
</dd>
<dt>radius<span class="classifier">float, optional</span></dt><dd><p>Radius of the anastomosis (mm in calling code; will be converted to m).</p>
</dd>
<dt>mu<span class="classifier">float, optional</span></dt><dd><p>Viscosity used to compute an approximate resistance for the new edge.</p>
</dd>
</dl>
<dl class="simple">
<dt>networkx.DiGraph</dt><dd><p>The modified graph with the new anastomosis edge and attributes set.</p>
</dd>
</dl>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># build graph first from parsed files</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">create_geometry</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">inlet_radius</span><span class="o">=</span><span class="mf">0.002</span><span class="p">,</span> <span class="n">strahler_ratio_arteries</span><span class="o">=</span><span class="mf">0.79</span><span class="p">)</span>
<span class="c1"># add a small anastomosis between ipnode indices 12 and 34</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">create_anastomosis</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">node_from</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">node_to</span><span class="o">=</span><span class="mi">34</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</dd>
<dt>create_venous_mesh</dt><dd><dl class="simple">
<dt>G<span class="classifier">networkx.DiGraph</span></dt><dd><p>The arterial graph to copy and relabel into a venous mesh.</p>
</dd>
<dt>num_artery_nodes<span class="classifier">int</span></dt><dd><p>Number of arterial nodes (used for relabelling offsets).</p>
</dd>
<dt>num_artery_edges<span class="classifier">int</span></dt><dd><p>Number of arterial edges (used to offset edge ids for veins).</p>
</dd>
<dt>num_terminal_arterial_nodes<span class="classifier">int</span></dt><dd><p>Number of terminal arterial nodes (used when connecting capillary equivalents).</p>
</dd>
<dt>outlet_vein_radius<span class="classifier">float</span></dt><dd><p>Vein outlet radius (m) used for radius assignment.</p>
</dd>
<dt>strahler_ratio_veins<span class="classifier">float</span></dt><dd><p>Strahler ratio used to scale vein radii.</p>
</dd>
<dt>max_strahler<span class="classifier">int</span></dt><dd><p>Maximum Strahler order in the arterial tree.</p>
</dd>
</dl>
<dl class="simple">
<dt>networkx.DiGraph</dt><dd><p>Venous mesh graph with relabelled nodes and vein attributes.</p>
</dd>
</dl>
</dd>
<dt>create_anastomosis</dt><dd><dl class="simple">
<dt>G<span class="classifier">networkx.DiGraph</span></dt><dd><p>Graph to modify.</p>
</dd>
<dt>node_from<span class="classifier">int</span></dt><dd><p>1-based ipnode index identifying the anastomosis start node.</p>
</dd>
<dt>node_to<span class="classifier">int</span></dt><dd><p>1-based ipnode index identifying the anastomosis end node.</p>
</dd>
<dt>radius<span class="classifier">float, optional</span></dt><dd><p>Radius of the anastomosis (mm in calling code; will be converted to m).</p>
</dd>
<dt>mu<span class="classifier">float, optional</span></dt><dd><p>Viscosity used to compute an approximate resistance for the new edge.</p>
</dd>
</dl>
<dl class="simple">
<dt>networkx.DiGraph</dt><dd><p>The modified graph with the new anastomosis edge and attributes set.</p>
</dd>
</dl>
</dd>
</dl>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">FetoFlow</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Modules:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="FetoFlow.html">FetoFlow</a></li>
<li class="toctree-l1"><a class="reference internal" href="bc_utils.html">bc_utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="file_parsing_utils.html">file_parsing_utils</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">geometry_utils</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#main-responsibilities">Main responsibilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#api-reference">API reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="#function-arguments">Function arguments</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="helper_functions.html">helper_functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="matrix_builder.html">matrix_builder</a></li>
<li class="toctree-l1"><a class="reference internal" href="pressure_flow_utils.html">pressure_flow_utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="resistance_utils.html">resistance_utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="solve_utils.html">solve_utils</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="file_parsing_utils.html" title="previous chapter">file_parsing_utils</a></li>
      <li>Next: <a href="helper_functions.html" title="next chapter">helper_functions</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Jude Beullens and Jordan Blennerhassett.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/geometry_utils.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>